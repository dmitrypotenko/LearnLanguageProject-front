<form [formGroup]="courseForm" (ngSubmit)="onSubmit()" class="p-4">
  <div class="form-group">
    <label for="courseName">
      Course name:
    </label>
    <input id="courseName" class="form-control" placeholder="Enter the course name" type="text" formControlName="name"
           required>

  </div>

  <div class="form-group">
    <label for="courseDesc">
      Description:
    </label>
    <input id="courseDesc" class="form-control" placeholder="Enter the course description" type="text"
           formControlName="description">
  </div>


  <div class="form-group">
    <label for="courseCategory">
      Category:
    </label>
    <input id="courseCategory" class="form-control" placeholder="Enter the course Category" type="text"
           formControlName="category">
  </div>


  <div id="accordion" formArrayName="steps" cdkDropList (cdkDropListDropped)="drop(courseForm, $event, 'steps')">
    <h5>Steps</h5>
    <button class="btn btn-primary m-2" (click)="addLesson()">Add Lesson</button>
    <button class="btn btn-primary m-2" (click)="addTest()">Add Test</button>

    <div *ngFor="let step of steps.controls; let i=index">
      <div cdkDrag *ngIf="isLesson(step)" class="step card-header d-flex justify-content-between"
           [attr.id]="'headingLesson'+i">
        <button class="btn btn-secondary btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseLesson'+i"
                aria-expanded="true"
                [attr.aria-controls]="'collapseLesson'+ i">
          Lesson: {{ step.get("name").value }}
        </button>
        <button class="btn btn-secondary btn-sm" (click)="delete(courseForm, step,'steps')">Delete &#10060;</button>
      </div>
      <div *ngIf="isLesson(step)" [attr.id]="'collapseLesson'+i" class="p-2 step collapse show border border-light"
           [attr.aria-labelledby]="'headingLesson'+i"
           data-parent="#accordion" formGroupName="{{i}}">
        <div class="form-group">
          <label for="lessonName">
            Name:
          </label>
          <input id="lessonName" class="form-control" placeholder="Enter the lesson name" type="text"
                 formControlName="name">
        </div>

        <div class="form-group">
          <label for="lessonVideo">
            Video Link:
          </label>
          <input id="lessonVideo" class="form-control" placeholder="Enter the video link for the lesson" type="text"
                 formControlName="videoLink">
        </div>

        <div class="form-group">
          <label for="lessonText">
            Lesson text:
          </label>
          <angular-editor id="lessonText" formControlName="lessonText" [config]="lessonEditorConfig">
          </angular-editor>
        </div>


        <div cdkDropList class="step attachments" formArrayName="attachments"
             (cdkDropListDropped)="drop(step, $event, 'attachments')">
          <h5>Attachments</h5>
          <button class="addition btn btn-primary btn-sm" (click)="addAttachment(step)">Add Attachment</button>
          <div *ngFor="let attachment of attachments(step).controls; let j=index">
            <div cdkDrag class="m-2 card-header d-flex justify-content-between" [attr.id]="'headingAttachment'+j">
              <button class="btn btn-secondary btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseAttachment'+j"
                      aria-expanded="true"
                      [attr.aria-controls]="'collapseAttachment'+j">
                Attachment: {{ attachment.get("attachmentTitle").value }}
              </button>
              <button class="btn btn-secondary btn-sm" (click)="delete(step, attachment, 'attachments')">Delete &#10060;</button>
            </div>
            <div [attr.id]="'collapseAttachment'+j" class="p-2 collapse show"
                 [attr.aria-labelledby]="'headingAttachment'+j"
                 [attr.data-parent]="'#collapseLesson'+i" formGroupName="{{j}}">
              <div class="form-group">
                <label for="attachmentTitle">
                  Title:
                </label>
                <input id="attachmentTitle" class="form-control" placeholder="Enter the title for the attachment"
                       type="text" formControlName="attachmentTitle">
              </div>
              <div class="form-group">
                <label for="attachmentLink">
                  Link to the file in google doc:
                </label>
                <input id="attachmentLink" class="form-control"
                       placeholder="Enter the link from the google google doc here" type="text"
                       formControlName="attachmentLink">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div cdkDrag *ngIf="isTest(step)" class="step card-header d-flex justify-content-between"
           [attr.id]="'headingTest'+i">
        <button class="btn btn-secondary btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseTest'+i" aria-expanded="true"
                [attr.aria-controls]="'collapseTest'+ i">
          Test: {{ step.get("name").value }}
        </button>
        <button class="btn btn-secondary btn-sm" (click)="delete(courseForm, step,'steps')">Delete &#10060;</button>
      </div>
      <div *ngIf="isTest(step)" [attr.id]="'collapseTest'+i" class="step collapse show border border-light"
           [attr.aria-labelledby]="'headingTest'+i"
           data-parent="#accordion" formGroupName="{{i}}">
        <div class="form-group">
          <label for="testName">
            Name:
          </label>
          <input id="testName" class="form-control"
                 placeholder="Enter the test name" type="text" formControlName="name">
        </div>

        <div cdkDropList class="step questions" formArrayName="questions"
             (cdkDropListDropped)="drop(step, $event, 'questions')">
          <h5>Questions</h5>
          <button class="btn btn-primary btn-sm addition" (click)="addQuestion(step)">Add Question</button>
          <div *ngFor="let question of questions(step).controls; let j=index">
            <div cdkDrag class="m-2 card-header d-flex justify-content-between" [attr.id]="'headingQuestion'+j">
              <button class="btn btn-secondary btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseQuestion'+j"
                      aria-expanded="true"
                      [attr.aria-controls]="'collapseQuestion'+ j">
                Question : {{question.get('questionText').value.substring(0, 10)}}
              </button>
              <button class="btn btn-secondary btn-sm" (click)="delete(step, question, 'questions')">Delete &#10060;</button>
            </div>
            <div [attr.id]="'collapseQuestion'+j" class="p-2 collapse show" [attr.aria-labelledby]="'headingQuestion'+j"
                 [attr.data-parent]="'#collapseTest'+i" formGroupName="{{j}}">
              <div class="form-group">
                <label for="questionText">
                  Question text:
                </label>
                <angular-editor id="questionText" (textSelect)="handleSelection( $event )"
                                formControlName="questionText"
                                [config]="questionEditorConfig">

                </angular-editor>
                <div
                  *ngIf="hostRectangle && isOmittedWords(question)"
                  class="indicator"
                  [style.left.px]="hostRectangle.left"
                  [style.top.px]="hostRectangle.top"
                  [style.width.px]="30"
                  [style.height.px]="0"
                  [class.invisible]="!isOmittedWords(question)">

                  <div class="indicator__cta">
                    <!--
                        NOTE: Because we DON'T WANT the selected text to get deselected
                        when we click on the call-to-action, we have to PREVENT THE
                        DEFAULT BEHAVIOR and STOP PROPAGATION on some of the events. The
                        byproduct of this is that the (click) event won't fire. As such,
                        we then have to consume the click-intent by way of the (mouseup)
                        event.
                    -->
                    <button class="btn btn-secondary btn-sm" (click)="wrapElement()" class="indicator__cta-link btn btn-secondary btn-sm"> Question
                      word?
                    </button>
                  </div>
                </div>
              </div>

              <div class="form-group w-25">
                <label for="questionType">
                  Which type of questions is it?
                </label>
                <select id="questionType" class="form-control" formControlName="type" [value]="question.get('type').value.toString()">
                  <option *ngFor="let questionType of questionTypes">
                    {{ questionType}}
                  </option>
                </select>
              </div>
              <div [class.invisible]="isOmittedWords(question)" cdkDropList class="variants"
                   formArrayName="variants"
                   (cdkDropListDropped)="drop(question, $event, 'variants')">
                <h5>Variants</h5>
                <button class="btn btn-primary btn-sm addition" (click)="addVariant(question)">Add Variant</button>
                <div *ngFor="let variant of variants(question).controls; let z=index">
                  <div cdkDrag class="m-2 card-header d-flex justify-content-between" [attr.id]="'headingVariant'+z">
                    <button class="btn btn-secondary btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseVariant'+z"
                            aria-expanded="true"
                            [attr.aria-controls]="'collapseVariant'+ z">Variant : {{variant.get('variantText').value}}
                    </button>
                    <button class="btn btn-secondary btn-sm" (click)="delete(question, variant, 'variants')">Delete &#10060;</button>
                  </div>
                  <div [attr.id]="'collapseVariant'+z" class="p-2 collapse show"
                       [attr.aria-labelledby]="'headingVariant'+z"
                       [attr.data-parent]="'#collapseQuestion'+j" formGroupName="{{z}}">
                    <div class="form-group">
                      <input placeholder="Enter the variant" type="text" class="form-control"
                             formControlName="variantText">
                    </div>
                    <div class="form-check">
                      <input id="isCorrect" class="form-check-input" [value]="variant.get('isRight').value" type="checkbox" formControlName="isRight">
                      <label class="form-check-label" for="isCorrect">
                        Is it correct?
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <input type="submit" id="submit" value="Submit" />
</form>

<hr>


<p style="margin-top: 1000px">
  Form Value: {{ courseForm.value | json }}
</p>

