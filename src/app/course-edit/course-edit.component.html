<form [formGroup]="courseForm" (ngSubmit)="onSubmit()">
  <label>
    Course name:
    <input type="text" formControlName="name" required>
  </label>

  <label>
    Description:
    <input type="text" formControlName="description">
  </label>

  <label>
    Category:
    <input type="text" formControlName="category">
  </label>

  <div id="accordion" formArrayName="steps" cdkDropList (cdkDropListDropped)="drop(courseForm, $event, 'steps')">
    <h5>Steps</h5>
    <button (click)="addLesson()">Add Lesson</button>
    <button (click)="addTest()">Add Test</button>

    <div *ngFor="let step of steps.controls; let i=index">
      <div class="card step" *ngIf="isLesson(step)">
        <div cdkDrag class="card-header d-flex justify-content-between" [attr.id]="'headingLesson'+i">
          <button class="btn btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseLesson'+i"
                  aria-expanded="true"
                  [attr.aria-controls]="'collapseLesson'+ i">
            Lesson: {{ step.get("name").value }}
          </button>
          <button class="btn btn-sm" (click)="delete(courseForm, step,'steps')">Delete</button>
        </div>
        <div [attr.id]="'collapseLesson'+i" class="collapse show" [attr.aria-labelledby]="'headingLesson'+i"
             data-parent="#accordion" formGroupName="{{i}}">
          <label>
            Name:
            <input type="text" formControlName="name">
          </label>

          <label>
            Video Link:
            <input type="text" formControlName="videoLink">
          </label>

          <label>
            Lesson text:
            <input type="text" formControlName="lessonText">
          </label>

          <div cdkDropList class="attachments" formArrayName="attachments"
               (cdkDropListDropped)="drop(step, $event, 'attachments')">
            <h5>Attachments</h5>
            <button (click)="addAttachment(step)">Add Attachment</button>
            <div *ngFor="let attachment of attachments(step).controls; let j=index">
              <div cdkDrag class="card-header d-flex justify-content-between" [attr.id]="'headingAttachment'+j">
                <button class="btn btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseAttachment'+j"
                        aria-expanded="true"
                        [attr.aria-controls]="'collapseAttachment'+j">
                  Attachment: {{ attachment.get("attachmentTitle").value }}
                </button>
                <button class="btn btn-sm" (click)="delete(step, attachment, 'attachments')">Delete</button>
              </div>
              <div [attr.id]="'collapseAttachment'+j" class="collapse show"
                   [attr.aria-labelledby]="'headingAttachment'+j"
                   [attr.data-parent]="'#collapseLesson'+i" formGroupName="{{j}}">
                <label>
                  Title:
                  <input type="text" formControlName="attachmentTitle">
                </label>
                <label>
                  Link to the file in google doc:
                  <input type="text" formControlName="attachmentLink">
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card step" *ngIf="isTest(step)">
        <div cdkDrag class="card-header d-flex justify-content-between" [attr.id]="'headingTest'+i">
          <button class="btn btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseTest'+i" aria-expanded="true"
                  [attr.aria-controls]="'collapseTest'+ i">
            Test: {{ step.get("name").value }}
          </button>
          <button class="btn btn-sm" (click)="delete(courseForm, step,'steps')">Delete</button>
        </div>
        <div [attr.id]="'collapseTest'+i" class="collapse show" [attr.aria-labelledby]="'headingTest'+i"
             data-parent="#accordion" formGroupName="{{i}}">
          <label>
            Name:
            <input type="text" formControlName="name">
          </label>

          <div cdkDropList class="questions" formArrayName="questions"
               (cdkDropListDropped)="drop(step, $event, 'questions')">
            <h5>Questions</h5>
            <button (click)="addQuestion(step)">Add Question</button>
            <div *ngFor="let question of questions(step).controls; let j=index">
              <div cdkDrag class="card-header d-flex justify-content-between" [attr.id]="'headingQuestion'+j">
                <button class="btn btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseQuestion'+j"
                        aria-expanded="true"
                        [attr.aria-controls]="'collapseQuestion'+ j">
                  Question : {{question.get('questionText').value}}
                </button>
                <button class="btn btn-sm" (click)="delete(step, question, 'questions')">Delete</button>
              </div>
              <div [attr.id]="'collapseQuestion'+j" class="collapse show" [attr.aria-labelledby]="'headingQuestion'+j"
                   [attr.data-parent]="'#collapseTest'+i" formGroupName="{{j}}">
                <label>
                  Question text:
                  <input type="text" formControlName="questionText">
                </label>
                <label>
                  Are there several correct answers?:
                  <input type="checkbox" formControlName="isMultiple">
                </label>
                <div cdkDropList class="variants" formArrayName="variants"
                     (cdkDropListDropped)="drop(question, $event, 'variants')">
                  <h5>Variants</h5>
                  <button (click)="addVariant(question)">Add Variant</button>
                  <div *ngFor="let variant of variants(question).controls; let z=index">
                    <div cdkDrag class="card-header d-flex justify-content-between" [attr.id]="'headingVariant'+z">
                      <button class="btn btn-sm" data-toggle="collapse" [attr.data-target]="'#collapseVariant'+z"
                              aria-expanded="true"
                              [attr.aria-controls]="'collapseVariant'+ z">Variant : {{variant.get('variantText').value}}
                      </button>
                      <button class="btn btn-sm" (click)="delete(question, variant, 'variants')">Delete</button>
                    </div>
                    <div [attr.id]="'collapseVariant'+z" class="collapse show"
                         [attr.aria-labelledby]="'headingVariant'+z"
                         [attr.data-parent]="'#collapseQuestion'+j" formGroupName="{{z}}">
                      <label>
                        <input type="text" formControlName="variantText">
                      </label>
                      <label>
                        Is it correct?:
                        <input type="checkbox" formControlName="isRight">
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <button type="submit" [disabled]="!courseForm.valid">Submit</button>
</form>

<hr>


<p>
  Form Value: {{ courseForm.value | json }}
</p>

